{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "Serilog": {
    "MinimumLevel": {
      "Default": "Information",
      "Override": {
        "Microsoft.AspNetCore.Hosting.Diagnostics": "Warning",
        "Microsoft.AspNetCore.Routing.EndpointMiddleware": "Warning",
        "Microsoft.AspNetCore.Mvc.Infrastructure": "Warning"
      }
    },
    "WriteTo": [
      {
        "Name": "Console",
        "Args": {
          "outputTemplate": "[{Timestamp:yyyy-MM-dd HH:mm:ss.fff zzz}] [{Level:u3}] [CorrelationId: {CorrelationId}] {Message:lj}{NewLine}{Exception}"
        }
      },
      {
        "Name": "File",
        "Args": {
          "path": "logs/cnab-api-.txt",
          "rollingInterval": "Day",
          "outputTemplate": "[{Timestamp:yyyy-MM-dd HH:mm:ss.fff zzz}] [{Level:u3}] [CorrelationId: {CorrelationId}] {Message:lj}{NewLine}{Exception}",
          "retainedFileCountLimit": 30
        }
      }
    ],
    "Enrich": [
      "FromLogContext",
      "WithMachineName",
      "WithEnvironmentUserName"
    ],
    "Properties": {
      "Application": "CnabApi"
    }
  },
  "ApplicationInsights": {
    "InstrumentationKey": ""
  },
  "AllowedHosts": "*",
  "ConnectionStrings": {
    "PostgresConnection": "Host=postgres;Port=5432;Database=cnab_db;Username=postgres;Password=postgres"
  },
  "Jwt": {
    "Issuer": "cnab-api",
    "Audience": "cnab-api-client",
    "SigningKey": "dev-signing-key-change-me-32-characters-minimum!!",
    "AccessTokenMinutes": 1440,
    "RefreshTokenDays": 30
  },
  "GitHubOAuth": {
    "ClientId": "",
    "ClientSecret": "",
    "CallbackUrl": "http://localhost:5000/api/v1/auth/github/callback"
  },
  "MinIO": {
    "Endpoint": "minio:9000",
    "AccessKey": "cnabuser",
    "SecretKey": "cnabpass123",
    "BucketName": "cnab-files",
    "UseSSL": false,
    "Region": "us-east-1"
  },
  "UploadProcessing": {
    "ParallelWorkers": 4,
    "CheckpointInterval": 1000,
    "MaxRetryPerLine": 3,
    "RetryDelayMs": 500,
    "RecoveryCheckIntervalMinutes": 5,
    "StuckUploadTimeoutMinutes": 30
  },
  "IpRateLimiting": {
    "EnableEndpointRateLimiting": true,
    "StackBlockedRequests": false,
    "RealIpHeader": "X-Real-IP",
    "ClientIdHeader": "X-ClientId",
    "HttpStatusCode": 429,
    "IpWhitelist": [],
    "EndpointWhitelist": [
      "get:/api/v1/health",
      "get:/api/v1/health/ready",
      "get:/api/v1/health/live"
    ],
    "ClientWhitelist": [],
    "GeneralRules": [
      {
        "Endpoint": "*",
        "Period": "1m",
        "Limit": 100
      },
      {
        "Endpoint": "*",
        "Period": "1h",
        "Limit": 1000
      },
      {
        "Endpoint": "post:/api/v1/transactions/upload",
        "Period": "1m",
        "Limit": 60
      },
      {
        "Endpoint": "post:/api/v1/auth/login",
        "Period": "1m",
        "Limit": 5
      },
      {
        "Endpoint": "post:/api/v1/auth/register",
        "Period": "1h",
        "Limit": 3
      }
    ],
    "QuotaExceededResponse": {
      "Content": "{{ \"error\": \"API rate limit exceeded. Maximum {0} requests per {1}.\" }}",
      "ContentType": "application/json",
      "StatusCode": 429
    }
  },
  "IpRateLimitPolicies": {
    "IpRules": []
  }
}
